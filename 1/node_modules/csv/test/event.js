// Generated by CoffeeScript 1.4.0

/*
Test CSV - Copyright David Worms <open@adaltas.com> (BSD Licensed)
*/


(function() {
  var csv, fs, should;

  require('coffee-script');

  fs = require('fs');

  should = require('should');

  csv = process.env.CSV_COV ? require('../lib-cov/csv') : require('../src/csv');

  describe('event', function() {
    return describe('record', function() {
      return it('should call error event if exception is thrown', function(next) {
        var count, errors, i, test, _i, _results;
        count = 0;
        errors = 0;
        test = csv().to.path("" + __dirname + "/write/write_array.tmp").on('record', function(record, index) {
          if (index % 10 === 0) {
            throw new Error("Error in record " + index);
          }
        }).on('error', function(e) {
          e.message.should.equal('Error in record 0');
          return next();
        }).on('close', function() {
          return false.should.be.ok;
        });
        _results = [];
        for (i = _i = 0; _i < 1000; i = ++_i) {
          if (test.writable) {
            _results.push(test.write(['Test ' + i, i, '"']));
          } else {
            _results.push(void 0);
          }
        }
        return _results;
      });
    });
  });

}).call(this);
